<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ“¦ AI + æ‰‹å‹•è£œé»è¨ˆæ•¸</title>

<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.22.0/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd"></script>

<style>
body {
  margin: 0;
  padding: 16px;
  background: #020617;
  color: #e5e7eb;
  font-family: system-ui, sans-serif;
  text-align: center;
}

h2 { margin-bottom: 8px; }

button {
  padding: 12px 16px;
  margin: 6px;
  font-size: 15px;
  border-radius: 12px;
  border: none;
  font-weight: bold;
}

.gallery { background:#38bdf8; }
.camera  { background:#facc15; }
.ai      { background:#22c55e; }
.clear   { background:#ef4444; }
.export  { background:#a855f7; }

canvas {
  max-width: 100%;
  margin-top: 14px;
  border-radius: 14px;
  background:#000;
}

details { margin: 10px 0; text-align:left; }
summary { cursor:pointer; font-weight:bold; }

fieldset {
  border:1px solid #334155;
  border-radius:12px;
  padding:10px;
}

label {
  display:inline-block;
  margin:4px 8px;
  font-size:14px;
}

#result {
  margin-top:10px;
  font-size:18px;
}

#modeSwitch {
  display: flex;
  justify-content: center;
  gap: 10px;
  margin: 10px 0 6px;
}

.mode {
  padding: 10px 16px;
  border-radius: 999px;
  font-size: 14px;
  background: #334155;
  color: #e5e7eb;
  border: none;
  font-weight: bold;
  opacity: 0.6;
}

.mode.active {
  background: #38bdf8;
  color: #020617;
  opacity: 1;
}
</style>
</head>

<body>

<h2>ğŸ“¦ AI + æ‰‹å‹•è£œé»è¨ˆæ•¸</h2>

<div id="modeSwitch">
  <button id="modeClassify" class="mode active">ğŸ¯ åˆ†é¡æ¨¡å¼</button>
  <button id="modeDensity" class="mode">ğŸŒ« å¯†åº¦æ¨¡å¼</button>
</div>

<!-- ğŸ”½ åˆ†é¡æ¨¡å¼å°ˆç”¨å€å¡Š -->
<div id="classifyPanel">

<button id="selectAllBtn">âœ… å…¨é¸</button>
<button id="deselectAllBtn">â›” å…¨ä¸é¸</button>

<details>
<summary>ğŸ‘¤ äººèˆ‡å‹•ç‰©</summary>
<fieldset>
<label><input type="checkbox" value="person"> äºº person</label>
<label><input type="checkbox" value="dog"> ç‹— dog</label>
<label><input type="checkbox" value="cat"> è²“ cat</label>
<label><input type="checkbox" value="horse"> é¦¬ horse</label>
<label><input type="checkbox" value="cow"> ç‰› cow</label>
<label><input type="checkbox" value="sheep"> ç¾Š sheep</label>
</fieldset>
</details>

<details>
<summary>ğŸ‘œ éš¨èº«ç‰©å“</summary>
<fieldset>
<label><input type="checkbox" value="backpack"> å¾ŒèƒŒåŒ…</label>
<label><input type="checkbox" value="handbag"> æ‰‹æåŒ…</label>
<label><input type="checkbox" value="suitcase"> è¡Œæç®±</label>
</fieldset>
</details>

<details>
<summary>ğŸ½ ç”Ÿæ´»ç”¨å“</summary>
<fieldset>
<label><input type="checkbox" value="chair"> æ¤…å­</label>
<label><input type="checkbox" value="diningtable"> æ¡Œå­</label>
<label><input type="checkbox" value="tv"> é›»è¦–</label>
<label><input type="checkbox" value="laptop"> ç­†é›»</label>
<label><input type="checkbox" value="cellphone"> æ‰‹æ©Ÿ</label>
</fieldset>
</details>

<details open>
<summary>ğŸš— äº¤é€šå·¥å…·</summary>
<fieldset>
<label><input type="checkbox" value="car" checked> car</label>
<label><input type="checkbox" value="truck" checked> truck</label>
<label><input type="checkbox" value="bus" checked> bus</label>
<label><input type="checkbox" value="motorcycle" checked> motorcycle</label>
<label><input type="checkbox" value="bicycle" checked> bicycle</label>
</fieldset>
</details>

</div>

<div>
<button class="gallery" id="btnGallery">ğŸ–¼ ç›¸ç°¿</button>
<button class="camera" id="btnCamera">ğŸ“¸ ç›¸æ©Ÿ</button>
</div>

<div>
<button class="ai" id="aiBtn" disabled>ğŸ¤– AI åµæ¸¬</button>
<button class="clear" id="clearBtn">ğŸ§¹ æ¸…é™¤</button>
<button class="export" id="exportBtn">ğŸ“¤ åŒ¯å‡º</button>
</div>

<div id="result">â³ è¼‰å…¥æ¨¡å‹ä¸­â€¦</div>
<canvas id="canvas"></canvas>

<input type="file" accept="image/*" hidden id="fileInput">
<input type="file" accept="image/*" capture="environment" hidden id="cameraInput">

<script>
const POINT_RADIUS = 20;
const HIT_RADIUS = 36;
const CLUSTER_DISTANCE = 80;

let MODE = "CLASSIFY";

const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
const result = document.getElementById("result");
const aiBtn = document.getElementById("aiBtn");
const classifyPanel = document.getElementById("classifyPanel");

const modeClassify = document.getElementById("modeClassify");
const modeDensity = document.getElementById("modeDensity");

let img = new Image();
let model;
let points = [];

modeClassify.onclick = () => switchMode("CLASSIFY");
modeDensity.onclick  = () => switchMode("DENSITY");

function switchMode(m) {
  MODE = m;
  modeClassify.classList.toggle("active", m === "CLASSIFY");
  modeDensity.classList.toggle("active", m === "DENSITY");

  classifyPanel.style.display = m === "CLASSIFY" ? "block" : "none";

  points = points.filter(p => p.source === "MANUAL");
  redraw();

  result.textContent =
    m === "CLASSIFY"
      ? "ğŸ¯ åˆ†é¡æ¨¡å¼ï¼šä¾ç‰©ä»¶é¡å‹è¨ˆæ•¸"
      : "ğŸŒ« å¯†åº¦æ¨¡å¼ï¼šä¸åˆ†ç¨®é¡ï¼Œç›´æ¥ä¼°ç®—æ•¸é‡";
}

/* å…¶é¤˜ JS ä¿æŒåŸæ¨£ï¼ˆæœªçœç•¥ï¼‰ */
</script>

</body>
</html>
